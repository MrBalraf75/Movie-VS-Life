<!DOCTYPE html>
<html>
<head>
    <title>Movie VS Life</title>
    <link rel="stylesheet" type="text/css" href="./style.css">
</head>
<body>
    <header>
        
<div class="header">

    <!--Content before waves-->
    <div class="inner-header flex">
    <!--Just the logo.. Don't mind this-->
    <img src="../assets/fish.png" style="width: 5%; margin:1%">
    <h1>Movie VS Life</h1>
    </div>
    
    <!--Waves Container-->
    <div>
    <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
    <defs>
    <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
    </defs>
    <g class="parallax">
    <use xlink:href="#gentle-wave" x="48" y="0" fill="rgba(255,255,255,0.7" />
    <use xlink:href="#gentle-wave" x="48" y="3" fill="rgba(255,255,255,0.5)" />
    <use xlink:href="#gentle-wave" x="48" y="5" fill="rgba(255,255,255,0.3)" />
    <use xlink:href="#gentle-wave" x="48" y="7" fill="#fff" />
    </g>
    </svg>
    </div>
    <!--Waves end-->
    
    </div>
    </header>
    <form id="form_search" class="div_search">
      <p class="rechercher">Rechercher</p>
      <label for="searchbar"></label>
      <input style="color: #fec45e;" class="search" id="search" onkeyup="search_movies()" type="text" name="search" placeholder="Un titre, un mot...">
      <input type="button" class="x" onclick="recherche()" value="X"></form>
<div id="spinner"></div>
<div class="content">
  <h1 class="heading">Vos films-</h1>
  <script type="text/javascript" src="script.js"></script>
  <a class="card" href="#!">
    <div class="front" style="background-image: url(//source.unsplash.com/300x401);">
      <p></p>
    </div>
    <div class="back">
      <div class="release_date"></div>
      <div>
        <p></p>
        <p></p>
        <button class="button"></button>
      </div>
    </div>
  </a>
</div>


</body>
</html>

<script type="text/javascript">

const card = document.querySelector('.content');
const spinner = document.querySelector('#spinner');

//récupère l'année du film
const getYearFromDate = (date) => {
  let year= date.split('-').shift();
  return year;
};

var genres_movies= '{ "genres": [ { "id": 28, "name": "Action" }, { "id": 12, "name": "Adventure" }, { "id": 16, "name": "Animation" }, { "id": 35, "name": "Comedy" }, { "id": 80, "name": "Crime" }, { "id": 99, "name": "Documentary" }, { "id": 18, "name": "Drama" }, { "id": 10751, "name": "Family" }, { "id": 14, "name": "Fantasy" }, { "id": 36, "name": "History" }, { "id": 27, "name": "Horror" }, { "id": 10402, "name": "Music" }, { "id": 9648, "name": "Mystery" }, { "id": 10749, "name": "Romance" }, { "id": 878, "name": "Science Fiction" }, { "id": 10770, "name": "TV Movie" }, { "id": 53, "name": "Thriller" }, { "id": 10752, "name": "War" }, { "id": 37, "name": "Western" } ] }';

const getNameGensFormId = (idGen) => {
  let genreName='';
  let obj = JSON.parse(genres_movies);
  for(let i=0;i<obj.genres.length;i++){
    if(idGen==obj.genres[i].id ){
      genreName=obj.genres[i].name;
      break;
    }
  }
  return genreName;
};

const getGenNames = (gensArrayIds) => {
  let gensName='';
  const sizeGenresArray = gensArrayIds.length;
  for(let i=0;i<sizeGenresArray;i++){
    gensName+=", "+getNameGensFormId( gensArrayIds[i] );
    
  }
  gensName = gensName.substr(1);
  return gensName;
};

function mapCards(movies){
  const html = movies.map(movie => {
    let title = movie.title || movie.name;
    let isMovieOrTv=(movie.title)?'movie':'tv';
    return `
      <div class="card" >
        <div class="frontWeb" style="background-image: url(//https://image.tmdb.org/t/p/w185//${movie.poster_path});"> 
          <p>${title}</p>
        </div>

        <div class="back">
          <div>
            <div class="release_date">${title} <span>(${getYearFromDate(movie.release_date)})</span></div>
            <div class="movie_gens">${getGenNames(movie.genre_ids)}</div>
            <div>noté ${movie.vote_average}/10</div>
            
            <p class="overview">${movie.overview}</p>
            <a target="_blank" href="https://www.themoviedb.org/${isMovieOrTv}/${movie.id}" class="button">En savoir plus</a>
          </div>
        </div>
      </div>
    `;
  }).join('');
  card.innerHTML= 
    `<h1 class="heading">Films</h1>`;
  card.innerHTML+= html;
}


async function fetchMovies(urlEndpoint) {
  let data;
  try {
    const response = await fetch(urlEndpoint);
    data = await response.json();
  } catch (error) {
    console.log(error);
  }
  return data.items || data.results;
}

(async () => {
  const movies = await fetchMovies(URL_API);
   spinner.setAttribute("hidden", "");
  mapCards(movies);
})();

	</script>

</body>
</html>